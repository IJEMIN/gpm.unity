# WebView

🌏 [한국어](README.md)

## 🚩 Table of Contents

* [Overview](#Overview)
* [Specifications](#Specifications)
* [Platform specific settings](#-Platform-specific-settings)
* [API](#-API)


## Overview

Provides a WebView used in various ways in the game.

## Specifications

### Supported Unity Version

* 2018.4.0 or higher

### Supported Android version

* 4.4 or higher

### Supported iOS version

* 11 or higher

### Supported platforms

* Anroid
* iOS 

### Supported features

| Category | Spec |
| --- | --- |
| Style | Popup |
|   | Fullscreen |
| Navigation | Title |
|   | Back |
|   | Forword |
|   | Close |
| Show API | URL, HTML file, HTML string |
|   | Open Callback |
|   | Close Callback |
|   | Scheme Callback |
|   | Scheme List |

## 🔨 Platform specific settings

###  Android

Uses [Gradle](https://docs.unity3d.com/Manual/android-gradle-overview.html) to set the dependencies needed in Android.
In a project that uses a version before Unity 2019.3, you need to switch to **Gradle** instead of **Internal** settings.

#### hardwareAccelerated 설정

원활한 WebView 사용을 위해 GPM WebView는 PostProcessBuild 스크립트에서 **hardwareAccelerated**를 활성화하고 있습니다.

#### Gradle settings

1.  Go to **File > Build Settings > Player Settings > Android > Publishing Settings** and enable **Custom Gradle Template** to create an `Assets/Plugins/Android/mainTemplate.gradle` file.
    * ![unity_gradle.png](images/unity_gradle.png)
    * If you are already using a mainTemplate.gradle file, you may skip this step.
2.  Remove the following comment line in mainTemplate.gradle.

    ```gradle
    // GENERATED BY UNITY. REMOVE THIS COMMENT TO PREVENT OVERWRITING WHEN EXPORTING AGAIN
    ```
3.  Add dependencies in mainTemplate.gradle.
    ```gradle
    dependencies {
        implementation 'org.jetbrains.kotlin:kotlin-stdlib-jdk7:1.3.72'
    }
    ```
    * If they are already added in another package, you may skip this step.

### iOS

#### Setting Other Linker Flags
    
In **Build Settings > Linking > Other Linker Flags** of Xcode Target(Unity-iPhone), you need to add -ObjC.

#### GPMWebView.bundle

Unity 특정 버전에서 iOS 빌드 시, NavigationBar의 버튼이 보이지 않는 현상이 발생할 수 있습니다.
해당 현상이 발생하면, Xcode Target(Unity-iPhone)의 **Xcode Project > Build Phases > Copy Bundle Resource** 설정에서 `+ 버튼`을 눌러 `GPMWebView.bundle 파일 검색하여 추가`하십시오.

![GPMWebViewBundle.png](images/GPMWebViewBundle.png)

## 🔨 API

### ShowUrl

Displays the WebView.

**Required parameter**

* url: the url transmitted to the parameter must be a valid value.
* openCallback: When WebView is open, the success result is notified via a callback.

**Optional parameter**

* configuration: With GpmWebViewRequest.Configuration, WebView options can be changed.
* closeCallback: The closing of WebView is notified to users via a callback.
* schemeList: Specifies the list of custom schemes that users want to receive.
    * Entering 'https://' allows you receive all URLs that begin with 'https://' as schemeEvent.
    * A scheme received as schemeEvent is not redirected.
* schemeEvent: Any URL that includes a custom scheme specified using schemeList is notified via a callback.

#### Configuration

| Parameter | Values | Description |
| ------------------------- | ----------------------------------------- | -------------------------------- |
| style                     | GpmWebViewStyle.POPUP                     | 팝업 모드 |
|                           | GpmWebViewStyle.FULLSCREEN                | 전체 화면 모드 |
| title                     | string                                    | WebView title |
| orientation               | UnityEngine.ScreenOrientation             | GPM WebView v1.1.0에서 제거되었습니다. |
| isBackButtonVisible       | bool                                      | 뒤로 가기 버튼 활성 또는 비활성  |
| isForwardButtonVisible    | bool                                      | 앞으로 가기 버튼 활성 또는 비활성 |
| contentMode</br>(iOS only)| GamebaseWebViewContentMode.RECOMMENDED    | recommended browsers for the current platform |
|                           | GamebaseWebViewContentMode.MOBILE         | mobile browser |
|                           | GamebaseWebViewContentMode.DESKTOP        | desktop browser |


**API**

```cs
public static void ShowUrl(
    string url,
    GpmWebViewRequest.Configuration configuration,
    GpmWebViewCallback.GpmWebViewErrorDelegate openCallback,
    GpmWebViewCallback.GpmWebViewErrorDelegate closeCallback,
    List<string> schemeList,
    GpmWebViewCallback.GpmWebViewDelegate<string> schemeEvent)
```

**Example**

```cs
public void ShowUrl()
{
    GpmWebView.ShowUrl(
        "http://gameplatform.toast.com/",
        new GpmWebViewRequest.Configuration()
        {
            style = GpmWebViewStyle.FULLSCREEN,
            title = "The page title.",
            isBackButtonVisible = true,
            isForwardButtonVisible = true,
#if UNITY_IOS
            contentMode = GpmWebViewContentMode.MOBILE
#endif
        },
        OnOpenCallback,
        OnCloseCallback,
        new List<string>()
        {
            "USER_ CUSTOM_SCHEME"
        },
        OnSchemeEvent);
}

private void OnOpenCallback(GpmWebViewError error)
{
    if (error == null)
    {
        Debug.Log("[OnOpenCallback] succeeded.");
    }
    else
    {
        Debug.Log(string.Format("[OnOpenCallback] failed. error:{0}", error));
    }
}

private void OnCloseCallback(GpmWebViewError error)
{
    if (error == null)
    {
        Debug.Log("[OnCloseCallback] succeeded.");
    }
    else
    {
        Debug.Log(string.Format("[OnCloseCallback] failed. error:{0}", error));
    }
}

private void OnSchemeEvent(string data, GpmWebViewError error)
{
    if (error == null)
    {
        Debug.Log("[OnSchemeEvent] succeeded.");
        
        if (data.Equals("USER_ CUSTOM_SCHEME") == true || data.Contains("CUSTOM_SCHEME") == true)
        {
            Debug.Log(string.Format("scheme:{0}", data));
        }
    }
    else
    {
        Debug.Log(string.Format("[OnSchemeEvent] failed. error:{0}", error));
    }
}
```

### ShowHtmlFile

`Assets > StreamingAssets` 폴더에 있는 HTML 파일을 웹뷰에 불러옵니다.

![StreamingAssets.png](images/StreamingAssets.png)

ShowHtmlFile API의 filePath 값은 아래 코드를 참고하여 입력하십시오.

```cs
#if UNITY_IOS
    // "file://" + Application.streamingAssetsPath + "/" + "YOUR_HTML_PATH.html"
    string.Format("file://{0}/{1}", Application.streamingAssetsPath, "YOUR_HTML_PATH.html");
#elif UNITY_ANDROID
    // "file:///android_asset/" + "YOUR_HTML_PATH.html"
    string.Format("file:///android_asset/{0}", "YOUR_HTML_PATH.html");
#endif
```

**API**

```cs
public static void ShowHtmlFile(
    string filePath,
    GpmWebViewRequest.Configuration configuration,
    GpmWebViewCallback.GpmWebViewErrorDelegate openCallback,
    GpmWebViewCallback.GpmWebViewErrorDelegate closeCallback,
    List<string> schemeList,
    GpmWebViewCallback.GpmWebViewDelegate<string> schemeEvent)
```

**Example**

```cs
public void ShowHtmlFile()
{
    var htmlFilePath = string.Empty;
#if UNITY_IOS
        htmlFilePath = string.Format("file://{0}/{1}", Application.streamingAssetsPath, "YOUR_HTML_PATH.html");
#elif UNITY_ANDROID
        htmlFilePath = string.Format("file:///android_asset/{0}", "YOUR_HTML_PATH.html");
#endif

    GpmWebView.ShowHtmlFile(
        htmlFilePath,
        new GpmWebViewRequest.Configuration()
        {
            style = GpmWebViewStyle.FULLSCREEN,
            title = "The page title.",
            isBackButtonVisible = true,
            isForwardButtonVisible = true,
#if UNITY_IOS
            contentMode = GpmWebViewContentMode.MOBILE
#endif
    },
        OnOpenCallback,
        OnCloseCallback,
        new List<string>()
        {
            "USER_ CUSTOM_SCHEME"
        },
        OnSchemeEvent);
}

private void OnOpenCallback(GpmWebViewError error)
{
    if (error == null)
    {
        Debug.Log("[OnOpenCallback] succeeded.");
    }
    else
    {
        Debug.Log(string.Format("[OnOpenCallback] failed. error:{0}", error));
    }
}

private void OnCloseCallback(GpmWebViewError error)
{
    if (error == null)
    {
        Debug.Log("[OnCloseCallback] succeeded.");
    }
    else
    {
        Debug.Log(string.Format("[OnCloseCallback] failed. error:{0}", error));
    }
}

private void OnSchemeEvent(string data, GpmWebViewError error)
{
    if (error == null)
    {
        Debug.Log("[OnSchemeEvent] succeeded.");
        
        if (data.Equals("USER_ CUSTOM_SCHEME") == true || data.Contains("CUSTOM_SCHEME") == true)
        {
            Debug.Log(string.Format("scheme:{0}", data));
        }
    }
    else
    {
        Debug.Log(string.Format("[OnSchemeEvent] failed. error:{0}", error));
    }
}
```

### ShowHtmlString

지정된 HTML 문자열을 웹뷰에서 불러옵니다.

**API**

```cs
public static void ShowHtmlString(
    string htmlString,
    GpmWebViewRequest.Configuration configuration,
    GpmWebViewCallback.GpmWebViewErrorDelegate openCallback,
    GpmWebViewCallback.GpmWebViewErrorDelegate closeCallback,
    List<string> schemeList,
    GpmWebViewCallback.GpmWebViewDelegate<string> schemeEvent)
```

**Example**

```cs
public void ShowHtmlString()
{
    GpmWebView.ShowHtmlString(
        "${HTML_STRING}",
        new GpmWebViewRequest.Configuration()
        {
            style = GpmWebViewStyle.FULLSCREEN,
            title = "The page title.",
            isBackButtonVisible = true,
            isForwardButtonVisible = true,
#if UNITY_IOS
            contentMode = GpmWebViewContentMode.MOBILE
#endif
        },
        OnOpenCallback,
        OnCloseCallback,
        new List<string>()
        {
            "USER_ CUSTOM_SCHEME"
        },
        OnSchemeEvent);
}

private void OnOpenCallback(GpmWebViewError error)
{
    if (error == null)
    {
        Debug.Log("[OnOpenCallback] succeeded.");
    }
    else
    {
        Debug.Log(string.Format("[OnOpenCallback] failed. error:{0}", error));
    }
}

private void OnCloseCallback(GpmWebViewError error)
{
    if (error == null)
    {
        Debug.Log("[OnCloseCallback] succeeded.");
    }
    else
    {
        Debug.Log(string.Format("[OnCloseCallback] failed. error:{0}", error));
    }
}

private void OnSchemeEvent(string data, GpmWebViewError error)
{
    if (error == null)
    {
        Debug.Log("[OnSchemeEvent] succeeded.");
        
        if (data.Equals("USER_ CUSTOM_SCHEME") == true || data.Contains("CUSTOM_SCHEME") == true)
        {
            Debug.Log(string.Format("scheme:{0}", data));
        }
    }
    else
    {
        Debug.Log(string.Format("[OnSchemeEvent] failed. error:{0}", error));
    }
}
```

### ExecuteJavaScript

지정된 JavaScript 문자열을 실행합니다.

**API**

```cs
public static void ExecuteJavaScript(string script)
```

**Example**

```cs
public void ExecuteJavaScriptSample()
{
    GpmWebView.ExecuteJavaScript("alert('ExecuteJavaScript');");
}
```

### Close

You can close the WebView using the following API.

**API**

```cs
public static void Close()
```

**Example**

```cs
public void Close()
{
    GpmWebView.Close();
}
```